## 0006 - Chat Page (replace modal), PWA installability, Currency "D", Autocomplete UX

### Context
Address four user-facing issues in a focused, incremental update:
- Replace the current Chats modal with a dedicated Chat page (improves usability and navigation).
- Fix PWA install issues (ensure the app is installable across supported browsers/environments).
- Add capital "D" as a currency display option in Settings (without breaking 3-letter ISO code storage).
- Improve Add Item modal so autocomplete does not block free text entry.

---

### Files To Create
- `src/components/ChatPage.vue`
  - Standalone page that mirrors current chat functionality from `ChatModal.vue`.
  - Reuse existing STT (`useSpeechToText`) and message send flow.

---

### Files To Modify
- `src/App.vue`
  - Add `'chat'` to view switch and render `ChatPage` instead of opening `ChatModal`.
  - Remove modal state handling for chat.

- `src/components/BottomNav.vue`
  - Update Chat tab to navigate to `'chat'` view (no dialog open logic).

- `src/components/ChatModal.vue`
  - Migrate logic to `ChatPage.vue` and deprecate component (keep file temporarily until callers are removed).

- `src/components/AddExpenseModal.vue`
  - Replace `v-autocomplete` with `v-combobox` (allows free-form input with suggestions).
  - Disable auto-select-first; hide no-data menu; ensure Enter submits typed text (not a suggestion).

- `src/components/SettingsPage.vue`
  - Add a new display preference for a custom currency symbol (supports single-letter "D").
  - Keep `currency` as 3-letter ISO code; write `currency_symbol` separately.

- `src/components/PwaInstall.vue`
  - Improve UX/state: show why Install is disabled; add fallback guidance when `beforeinstallprompt` never fires.
  - Detect standalone mode reliably and hide button when already installed.

- `src/lib/supabase.js`
  - Extend `getProfile`/`updateProfile` to include `currency_symbol` field.

- `src/lib/currency.js` (new or extend if exists)
  - Add `formatAmount(amount, { code, symbolOverride })` to render with ISO code or custom symbol (e.g., `D`).

---

### Data Layer (DB + Migration)
- Add optional `currency_symbol` to `public.profiles` (keeps existing 3-letter `currency` constraint):
  - Column: `currency_symbol text null check (char_length(currency_symbol) between 1 and 4)`
  - Trigger: reuse existing `set_updated_at`.
  - RLS: existing select/update policies cover the new column.
- Migration file: `supabase/migrations/<timestamp>_profiles_add_currency_symbol.sql`.

Notes:
- Continue storing ISO currency code (e.g., `USD`) in `currency` (length = 3 enforced).
- Use `currency_symbol` for UI display overrides. When unset, default to symbol derived from `currency`.

---

### Implementation Details

1) Chat Page (replace modal)
   - Create `ChatPage.vue` by moving logic/template from `ChatModal.vue` into a page layout (no `v-dialog`).
   - Keep message list, input row, Send button, and STT mic button identical.
   - Update `App.vue` to route view state to `'chat'` and render `ChatPage` in place of opening a dialog.
   - Update `BottomNav.vue` Chat button to call `navigate('chat')`.

2) PWA installability
   - Validate SW registration (`virtual:pwa-register` is already called in `src/main.js`).
   - Ensure `public/icons` includes 192 and 512 (maskable) icons (present). Manifest uses `display: 'standalone'`, `start_url: '/'`.
   - Keep `VitePWA({ devOptions: { enabled: true } })` for dev testing. Confirm HTTPS on production (Netlify provides TLS).
   - Update `PwaInstall.vue`:
     - Track `canInstall` from `beforeinstallprompt`; if it never fires, render a small hint: "Install isn’t available in this browser/context." (e.g., iOS Safari).
     - Handle `appinstalled` to hide button and toast success (already present).
     - Detect standalone via `(display-mode: standalone)` and user agent fallbacks.
   - Acceptance: Chrome (desktop/mobile) shows Install button when eligible; clicking prompts and installs. Safari iOS shows guidance when not eligible.

3) Currency display: add capital "D"
   - DB: add `currency_symbol` column; update profile fetch/update to include it.
   - Settings UI: add a text input for "Display symbol" with quick-pick options including `D`; validate length 1–4.
   - Formatting: use `formatAmount(amount, { code: currency, symbolOverride: currency_symbol })` everywhere amounts are shown.
   - Acceptance: Selecting `D` shows `D10.00` (or `D 10.00`) throughout; stored ISO code remains e.g. `USD`.

4) Add Item modal: autocomplete UX
   - Switch `v-autocomplete` → `v-combobox` with `:items="suggestions"` so free text is allowed.
   - Set props to reduce interference: `:auto-select-first="false"`, `hide-no-data`, appropriate `menu-props` (open on input focus only), ensure Enter preserves user text.
   - Keep emitted payload `{ item, cost, date }` unchanged.
   - Acceptance: User can type a new item name and press Enter/Save without suggestions taking over; suggestions still appear and are selectable.

---

### UI Details
- `ChatPage.vue`: page title "Chat"; scrollable messages; input row with mic and send.
- `SettingsPage.vue`: sections for Profile, Security, Preferences. Add a field under Preferences: "Display symbol" with helper text; Save button persists both `currency` and `currency_symbol` independently.
- `AddExpenseModal.vue`: `v-combobox` for Item; numeric `v-text-field` for Cost remains unchanged.

---

### Validation and Errors
- `currency_symbol`: 1–4 visible characters; trim whitespace; store `null` when cleared.
- Block invalid input with a toast in UI; throw from lib on invalid updates.
- Do not silently coerce values.

---

### Acceptance Checks
- Chat page replaces modal: Bottom nav Chat opens full page; sending works; STT works; no dialog appears.
- PWA: Install button appears on eligible browsers; install completes; app reports installed state; no console errors from SW/manifest.
- Currency "D": Settings allows entering/displaying `D`; amounts across Day/Month views reflect the symbol; DB continues enforcing 3-letter `currency`.
- Add Item: Typing a new item is smooth; suggestions do not override; Save emits correct payload.

---

### Rollout
- Ship in four small PRs in order: (1) Chat page, (2) Add Item combobox, (3) Currency symbol support (DB + UI + formatting), (4) PWA install UX improvements.
- After each, run `npm run build` and verify a clean build.

