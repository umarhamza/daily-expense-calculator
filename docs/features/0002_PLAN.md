# Feature Plan — Mobile Chat UI like ChatGPT

## Context
Design and implement the chat page to mirror the ChatGPT mobile interface. Focus on mobile-first UX with a clean message stream, sticky composer over a safe-area inset, and a minimalist header. Keep implementation aligned with Vue 3 + Vite + TailwindCSS 4 stack and centralize data access in `src/lib`.

Verbatim user goal:
- the chat page should be designed like chatgpt mobile interface

## Scope
Mobile-first chat page layout and interactions that visually and behaviorally resemble ChatGPT’s mobile UI. Includes message list, input composer with send/stop actions, typing indicator, and sensible empty states. No code is provided in this plan; it specifies files to create/update and behaviors.

Out of scope: authentication changes, model/provider swaps, new backend endpoints beyond existing chat function; large design system overhauls.

## Files to create/update
- src/components/ChatPage.vue
  - Structure: full-height flex column; header, scrollable messages, sticky composer.
  - Header: back button (if needed), chat title (single line, truncates), overflow menu for actions.
  - Messages: virtual-friendly container; bubbles with role-aware styling; timestamps on hover/long-press; support markdown rendering for assistant.
  - Composer: multiline `textarea` that grows up to 5 lines, send button, and stop button while streaming; placeholder conveys “Send a message…”.
  - Empty state: centered prompt suggestions and helpful tips matching app domain.
  - Loading states: skeletons for assistant messages and a pulsing typing indicator.
- src/components/chat/MessageItem.vue (new, presentational)
  - Props: `role`, `content`, optional `error`, `isStreaming`.
  - Handles assistant markdown, copy-to-clipboard control, and long-press menu on mobile.
- src/components/chat/MessageList.vue (new, presentational)
  - Props: `messages`, `isLoading`, `onRetryLast?` (emit event).
  - Auto-scroll to bottom with guard if user is reading older messages; show "jump to latest" affordance.
- src/components/chat/Composer.vue (new, presentational)
  - Props: `isSending`, `value` + `@update:value`, emits `send`, `stop`.
  - Mobile behaviors: submit on Enter (without Shift), grows up to max height, respects safe-area insets.
- src/lib/ui/scroll.js (new, utility)
  - Helpers for auto-scroll, scroll anchoring, and visibility checks.
- src/assets/main.css
  - If necessary, add minimal CSS variables for safe-area (`env(safe-area-inset-bottom)`) and markdown content defaults; prefer Tailwind utilities otherwise.

## Relevant existing code references
- `src/components/ChatPage.vue` — current chat view to update or replace with the described layout.
- `src/lib/supabase.js` — data-access; reuse existing chat/message helpers if present (per 0001 plan).
- `netlify/functions/chat.js` — chat backend; UI should call this and handle streaming/response lifecycle according to current contract.
- `src/App.vue`, navigation components — ensure routing lands on the chat page.

## UI layout and behaviors (mobile-first)
- Header
  - Minimal height, sticky at top, gradient fade into content optional.
  - Title collapses to single line; menu with: New chat, Rename chat, Delete chat.
- Message list
  - Background neutral; messages appear in a clean vertical stream with adequate spacing.
  - User bubbles right-aligned with solid accent; assistant left with neutral surface.
  - Support markdown (code blocks, lists). Provide copy and "select text" affordances.
  - Streaming: show typing indicator and progressively revealed assistant text.
  - Scrolling: auto-stick to bottom unless user scrolls up; show "jump to latest" fab when not at bottom.
- Composer
  - Sticky at bottom over safe-area; shadow and subtle border.
  - Multiline textarea, expandable to ~5 lines; shows character count soft limit if needed.
  - Buttons: primary Send, secondary Stop when streaming; disable send on empty/whitespace input.
  - Keyboard return sends if not composing with IME; Shift+Enter inserts newline.
- Empty state
  - Centered content with app logo, short helpers, and 3–4 suggestion chips; tapping chip inserts into composer.

## Accessibility
- Sufficient color contrast for bubbles and text.
- `aria-live="polite"` region for incoming assistant tokens.
- Buttons labeled with `aria-label`; keyboard focus order maintained.
- Respect reduced motion (disable pulsating typing indicator).

## Data flow and events
- Props down, events up. Keep presentational components stateless regarding network calls.
- `ChatPage.vue` orchestrates:
  1) Loads messages for the active chat via `src/lib/supabase.js` helpers.
  2) On send: optimistically append user message, call `/.netlify/functions/chat` with `chatId` and current text, handle streaming/response, then persist assistant message.
  3) On stop: signal cancellation to the in-flight request if supported; otherwise ignore further tokens.
  4) On delete/rename: surface confirm UI and call data-access helpers; update local state.
  5) Maintain `isSending`, `isStreaming`, `hasError`, `composerValue`, `atBottom` state.

## Tailwind utility guidance
- Container: `flex flex-col h-dvh bg-neutral-50 dark:bg-neutral-900`.
- Header: `sticky top-0 z-10 backdrop-blur border-b` with neutral colors.
- List: `flex-1 overflow-y-auto px-3 py-2` with responsive gaps.
- Bubbles:
  - User: `self-end max-w-[82%] rounded-2xl rounded-br-sm bg-primary-600 text-white dark:bg-primary-500`.
  - Assistant: `self-start max-w-[88%] rounded-2xl rounded-bl-sm bg-white text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100 border`.
- Composer: `sticky bottom-0 z-10 border-t bg-neutral-50/80 dark:bg-neutral-900/80 backdrop-blur p-2` with an inner `textarea` styled via utilities.

## Edge cases and constraints
- Very long messages: clamp max width, allow horizontal scroll in code blocks only.
- Image/attachments: not in scope; ensure layout doesn’t break if added later.
- Offline/failed request: show retry on last assistant message; preserve user input.
- Safe-area insets: pad composer with `pb-[env(safe-area-inset-bottom)]`.
- Performance: avoid heavy reflows on token streaming; batch updates and use requestAnimationFrame if needed.

## Implementation phases (small)
- Phase A — Components and layout
  - Create `MessageItem.vue`, `MessageList.vue`, `Composer.vue` with static props and slots.
  - Apply Tailwind utilities and a11y attributes.
- Phase B — Wire data and interactions
  - Integrate with `ChatPage.vue` state and `src/lib/supabase.js` helpers.
  - Implement auto-scroll, jump-to-latest, and optimistic updates.
- Phase C — Polish
  - Markdown styles, copy buttons, long-press menu, reduced motion.

## Testing notes
- Validate on narrow widths (320–480 px) and dark mode.
- Confirm auto-scroll behavior when user is reading older messages.
- Ensure composer focus and keyboard interactions work on mobile (iOS/Android).

