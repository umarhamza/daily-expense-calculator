# Feature Plan — Remove Chat Dark Mode and Fix currencySymbol Error

## Context
We need to: (1) remove dark mode styling from the chat page UI, and (2) fix a backend bug where `currencySymbol` is undefined in the chat function when formatting totals. This plan follows prior feature plan structure and aims for minimal, targeted edits per repository rules.

## Scope
- Remove all Tailwind `dark:` classes and dark-mode conditionals from chat UI components only.
- Fix `currencySymbol is not defined` errors in `netlify/functions/chat.js` by resolving the symbol once and passing it to formatters.

Out of scope: global dark mode removal, theming changes outside chat components, Tailwind config changes, unrelated refactors.

## Files to create/update
- netlify/functions/chat.js
  - Resolve `currencySymbol` at the start of spend-answering logic and use it for all formatting.
- src/components/ChatPage.vue
  - Remove `dark:` utility classes from container, header, and title text.
- src/components/chat/MessageItem.vue
  - Remove `dark:` utilities from assistant bubble and copy button.
- src/components/chat/MessageList.vue
  - Remove `dark:` utilities from the “Jump to latest” button.
- src/components/chat/Composer.vue
  - Remove `dark:` utilities from the sticky composer container and textarea.

## Implementation details

### 1) Fix currencySymbol undefined in chat function
- Location: `netlify/functions/chat.js`
- Problem: `answerSpendQuestion` references `currencySymbol` without defining it, e.g., in lines where `formatAmount(..., currencySymbol)` is called.
- Approach:
  1. Fetch the user’s symbol once via the existing `getCurrencySymbol(supabase)` helper at the beginning of `answerSpendQuestion`.
  2. Store as a local `const currencySymbol = await getCurrencySymbol(supabase)` and pass to all `formatAmount` calls in that function.
  3. Ensure the quick comparison branch (this week vs last week) and top items branch both use this local variable.
  4. No changes to return shapes; only formatting.

Acceptance: No runtime ReferenceError; amounts are formatted with a user symbol when present, otherwise plain numbers.

### 2) Remove dark mode from chat page UI
- Keep light theme utilities as-is; remove only `dark:` variants.
- Files and selectors:
  - `src/components/ChatPage.vue`
    - Container: `class="flex flex-col h-dvh bg-neutral-50 dark:bg-neutral-900"` → drop `dark:bg-neutral-900`.
    - Header: `bg-neutral-50/80 dark:bg-neutral-900/80` → drop dark variant.
    - Title: `text-neutral-700 dark:text-neutral-200` → drop dark variant.
  - `src/components/chat/MessageItem.vue`
    - Assistant bubble: `bg-white text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100 ...` → drop both dark variants.
    - Copy button: `... text-neutral-700 dark:text-neutral-200 dark:border-neutral-600` → drop dark variants.
  - `src/components/chat/MessageList.vue`
    - “Jump to latest” button: `... bg-neutral-800 text-white dark:bg-neutral-200 dark:text-neutral-900` → drop dark variants.
  - `src/components/chat/Composer.vue`
    - Container: `bg-neutral-50/80 dark:bg-neutral-900/80` → drop dark variant.
    - Textarea: `bg-white dark:bg-neutral-800` → drop dark variant.

Acceptance: Chat page renders identically in light mode; no `dark:` utilities remain in these files.

## Steps
1) Backend fix
   - Add `const currencySymbol = await getCurrencySymbol(supabase)` at the top of `answerSpendQuestion`.
   - Use this variable for all `formatAmount` invocations in the function.
2) UI updates
   - Edit the four chat components listed and remove `dark:` classes only, keeping existing light classes and layout intact.
3) Build and verify
   - Run `npm run build` to confirm no type or bundling errors.
   - Manual checks: send chat queries for totals and “this week vs last week”; confirm currency symbol formatting.
   - Visual check: confirm chat page looks correct in light theme; verify no `dark:` classes remain.

## Edge cases and constraints
- If user’s `currency_symbol` is empty or whitespace, formatting should omit the prefix and display plain numbers (existing `formatAmount` behavior).
- Do not alter non-chat components or global Tailwind configuration.
- Avoid adding new dependencies; keep edits minimal.

## Testing notes
- Backend: Quick smoke test via the UI to hit `/.netlify/functions/chat`:
  - “Total this week vs last week” → response should include formatted amounts without errors.
  - “Top items this month” → list lines include symbol formatting where applicable.
- Frontend: Verify chat page in a browser:
  - No visual regressions in light theme.
  - No `dark:` classes in the compiled markup for the affected components.

## Relevant current code references
- `netlify/functions/chat.js` — `answerSpendQuestion` uses `formatAmount(..., currencySymbol)` without declaring `currencySymbol`.
- `src/components/ChatPage.vue` — uses `dark:bg-neutral-900`, `dark:text-neutral-200` in container/header/title.
- `src/components/chat/MessageItem.vue` — uses `dark:bg-neutral-800`, `dark:text-neutral-100`, `dark:text-neutral-200`, `dark:border-neutral-600`.
- `src/components/chat/MessageList.vue` — uses `dark:bg-neutral-200`, `dark:text-neutral-900` on the jump button.
- `src/components/chat/Composer.vue` — uses `dark:bg-neutral-900/80`, `dark:bg-neutral-800`.

