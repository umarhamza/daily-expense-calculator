## Settings Page: username, password, currency, and PWA install button

### Context
Add a Settings view to the existing Vue 3 + Vuetify single-view app (no router) so a signed-in user can:
- Change their username (display name)
- Change their password
- Change their currency used for displaying amounts
- Install the PWA via an explicit Install button

Use Supabase auth user metadata to persist `display_name` and `currency` across devices. Password updates use Supabase `auth.updateUser({ password })`. Currency display should be centralized and applied in `DayView` and `MonthView` (replacing the current hardcoded "D"). PWA install uses the `beforeinstallprompt` event and the existing `vite-plugin-pwa` setup.

### Files to Create
- `src/components/SettingsPage.vue`
  - Sections: Profile (display name), Security (password), Preferences (currency), PWA (install button/status)
  - Emits none; internal calls to lib functions; uses toasts for feedback

- `src/components/PwaInstall.vue`
  - Encapsulates PWA install prompt handling
  - Props none; emits optional `installed` when completed

- `src/lib/currency.js`
  - Exports `formatCurrency(amount, currencyCode)` and `getDefaultCurrency()`

### Files to Modify
- `src/App.vue`
  - Add `'settings'` to `currentView` options and switch
  - Render `SettingsPage` when selected
  - Keep auth/session handling in place

- `src/components/BottomNav.vue`
  - Add a fourth navigation button `Settings` (e.g., icon `mdi-cog`), emitting `navigate('settings')`

- `src/components/DayView.vue`
  - Replace hardcoded currency prefix with `formatCurrency(e.cost, currency)`
  - Accept `currency` as a prop from `App.vue` or import a reactive settings composable (see below)

- `src/components/MonthView.vue`
  - Replace hardcoded currency prefix in list and totals with `formatCurrency(...)`
  - Accept `currency` prop or import composable

- `src/lib/supabase.js`
  - Add small, focused helpers:
    - `getCurrentUser()` → returns `supabase.auth.getUser()` data
    - `updateUserMetadata(partial)` → calls `supabase.auth.updateUser({ data: partial })`
    - `updateUserPassword(newPassword)` → calls `supabase.auth.updateUser({ password: newPassword })`

### Data Model and State
- No database schema change; store profile preferences in Supabase auth user metadata:
  - `display_name: string`
  - `currency: string` (ISO 4217, e.g., `USD`, `EUR`, `GBP`)
- On sign-in, read metadata to initialize UI. Fallback to `USD` if unset.
- Also mirror the last-used currency in `localStorage` to avoid flicker before metadata is fetched; metadata remains the source of truth.

### Algorithms / Flows
- Username update (display name)
  1) User enters a non-empty `display_name` (trim, length 1–64) and submits
  2) Call `updateUserMetadata({ display_name })`
  3) On success: update local state and `localStorage`; show success toast
  4) On error: show error toast; do not silently swallow

- Password update
  1) User enters `newPassword` and `confirmPassword` (min 6 chars, match)
  2) Call `updateUserPassword(newPassword)`
  3) On success: show success toast (warn that re-login may be required by Supabase policies)
  4) On error: show error toast

- Currency change
  1) User selects currency code from a vetted list (e.g., `USD`, `EUR`, `GBP`, `JPY`, `AUD`, `CAD`)
  2) Call `updateUserMetadata({ currency })`
  3) Persist selected currency to `localStorage` for faster next boot
  4) Re-render amounts by using `formatCurrency` wherever amounts are displayed

- Currency formatting (`src/lib/currency.js`)
  - `formatCurrency(amount: number, currencyCode: string): string`
    - Guard against non-finite numbers and fallback to 0.00
    - Use `Intl.NumberFormat(undefined, { style: 'currency', currency: currencyCode || 'USD', maximumFractionDigits: 2 })`
  - `getDefaultCurrency(): string` → read from `localStorage` or `'USD'`

- PWA install button (`src/components/PwaInstall.vue`)
  1) Listen once for `window.beforeinstallprompt` → store the event in a ref; set `canInstall = true`
  2) If `canInstall`, show an Install button; on click, call `event.prompt()`, await `userChoice`
  3) If accepted → emit `installed` and hide the button; if dismissed → keep button visible
  4) Also listen to `window.appinstalled` → hide button and show success toast
  5) If already installed (display-mode: standalone), hide button

### UI Details (Vuetify)
- `src/components/SettingsPage.vue`
  - Title: Settings
  - Profile section: `v-text-field` (Display Name), Save button
  - Security section: `v-text-field` (New Password), `v-text-field` (Confirm), Update button
  - Preferences section: `v-select` (Currency list)
  - PWA section: include `<PwaInstall />` component
  - Use existing toast helpers from `src/lib/toast.js`

### Integration Details
- `src/App.vue`
  - Maintain `session` and `userId` as-is
  - On session load, fetch user metadata (`display_name`, `currency`) and provide `currency` down to `DayView` and `MonthView` via prop
  - Add handling in `handleNavigate('settings')`

- `src/components/BottomNav.vue`
  - Add settings tab/button (e.g., order: Day, Month, Chat, Settings)

- `src/components/DayView.vue` and `src/components/MonthView.vue`
  - Add `props: { currency: String }`
  - Replace occurrences of amount rendering (currently `D{{ e.cost.toFixed(2) }}`) with `formatCurrency(e.cost, props.currency)`

### Validation and Errors
- Display name: trim, non-empty, max length 64
- Password: min length 6, must match confirmation
- Currency: restrict to known codes; default `USD` when missing/invalid
- All lib calls must throw on error; UI catches and shows toast via `showErrorToast`

### Notes and Constraints
- No router is introduced; the Settings view is toggled like existing views
- Keep Supabase interactions inside `src/lib/supabase.js`
- Do not log secrets; do not persist Supabase keys
- Avoid broad refactors; keep edits minimal and localized

### Out of Scope
- Changing auth email address
- Profile avatar uploads
- Server-side validation beyond Supabase auth constraints

### Acceptance Checks (developer)
- Signed-in user can update display name; subsequent refresh shows updated value (metadata)
- Password update succeeds with valid input and shows feedback
- Currency selection updates and persists; amounts in Day and Month views reflect formatting
- Install button appears when the app is installable; clicking prompts install and then hides after installation
